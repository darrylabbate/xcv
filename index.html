<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>xcv</title>
<link rel="stylesheet" href="style.css" />
<script src="lzma.js"></script>
<script>
    var lzma = new LZMA("lzma_worker.js");
    function createURL() {
        var txt = document.getElementById("main-text").value;
        lzma.compress(txt, 1, function on_compress_complete(compressed) {
            var reader = new FileReader();
            reader.onload = function() {
                var b64 = reader.result.substr(reader.result.indexOf(",")+1);
                var fullURL = window.location.protocol + "//" +
                    window.location.host + window.location.pathname +
                    "#" + b64;
                document.getElementById("url-test").value = fullURL;
            };
            reader.readAsDataURL(new Blob([new Uint8Array(compressed)]));
        }
        );
    }
</script>
</head>
<body>
<div class="main">
    <textarea id="url-test"></textarea>
    <br>
    <a onclick="createURL()">GET LINK</a>
    <br>
    <textarea autofocus
              id="main-text"
              autocomplete="off"
              autocapitalize="off"
              spellcheck="false"
              placeholder="input text here"></textarea>
</div>
<script>
    var b64 = window.location.hash.substr(1);
    if (b64.length > 0) {
        var lzma = new LZMA("lzma_worker.js");
        fetch("data:application/octet-stream;base64,"+b64)
            .then(r => r.blob())
            .then(function(blob) {
            var reader = new FileReader();
            reader.onload = function(){
            var compressed = Array.from(new Uint8Array(reader.result));
            lzma.decompress(compressed, function(plaintext, err){
            if (err) {
                alert("Decompression error: " + err);
                return;
            }

            document.getElementById("main-text").value = plaintext;
            });
            };
            reader.readAsArrayBuffer(blob);
        });
    }
</script>
</body>
</html>
